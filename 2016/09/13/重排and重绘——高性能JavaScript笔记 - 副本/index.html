<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Welcome to tvChan&#39;s Blog!">
    

    <!--Author-->
    
        <meta name="author" content="tvChan">
    

    <!-- Title -->
    
    <title>重排and重绘 | tvChan&#39;s Blog</title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//at.alicdn.com/t/font_1of8hhckxro7ds4i.css" rel="stylesheet" type="text/css">
    <!-- Highlight -->
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/tomorrow.min.css">

</head>
	<body>
		<div class="bg"></div>
		<div class="wrapper">
			<div class="main-header container">
	<div class="box">
		<h1 class="u-tit"><a href="/">tv_哇</a></h1>
		<div class="m-nav">
			<a href="https://github.com/tvChan" target="_blank" class="nav1_4 iconfont icon-github"></a>
			<a href="http://music.163.com/#/user/home?id=10020158" target="_blank" class="nav1_5 iconfont icon-musiccloud"></a>
			<a href="https://www.zhihu.com/people/tv_wawawa" target="_blank" class="iconfont icon-zhihu"></a>
			<a href="https://www.douban.com/people/tv_wawawa/" target="_blank" class="iconfont icon-douban"></a>
		</div>
	</div>
</div>
			<div class="article-all g-mn" style="padding:0 0 50px">
	<div class="g-box f-cb container">

		<!--文章列表 start-->
		<div class="m-post m-post-text" style="padding-top:68px">
			<div class="cont ">
				<div class="text f-cb">
					<h1 class="title">重排and重绘</h1>
					<h3 id="什么是重排，重绘？"><a href="#什么是重排，重绘？" class="headerlink" title="什么是重排，重绘？"></a>什么是重排，重绘？</h3><p>在我还是菜菜菜鸟时，有人就问我了。你知道什么操作会引起重排吗？</p>
<p>当时就在想，重排是个什么东东。。。于是，Google了一下（说谷歌显的高大上点(⊙﹏⊙)b）<br>当然，提到重排重绘，就理所当然会提及DOM树和渲染树等等~ 这就让我们一个个慢慢道来。</p>
<p>高性能JavaScript里是这么说的：</p>
<p>“浏览器下载完页面中的所有组件————HTML标记、JavaScript、CSS、图片————之后就会解析并生成两个内部<strong>数据结构</strong>”</p>
<blockquote>
<p>DOM树</p>
</blockquote>
<p>表示页面结构</p>
<blockquote>
<p>渲染树</p>
</blockquote>
<p>表示DOM节点如何显示</p>
<p>DOM树和渲染树就是相互存在的一种数据结构，DOM树里每一个需要显示的节点在渲染树里至少会有一个对应的节点（当然，隐藏的DOM元素在渲染树里是没用节点的）渲染树的节点可以叫“帧”或者“盒”，可以理解为CSS里面的盒子吧，就可以把对应的页面元素理解为一个具有padding，margin，border和position（位置）的盒子。一旦这DOM树和渲染树相互构建完成之后，浏览器就可以要是显示（绘制paint）页面元素了。</p>
<p>可是怎么理解呢，就举个栗子吧，不知道大家画过画没，数字油画呢？就用它来说栗子：</p>
<ol>
<li>比如我要画个柯南，你要想把，柯南肯定是个人吧，有眼睛，鼻子，嘴巴，耳朵各种五官吧，当然还要穿衣服吧，可以还可以把他爱人小兰画上吧。就是你画像需要显示的内容就是对应DOM树的节点，他们的集合就构成一棵DOM树吧；</li>
<li>那当你决定要画的时候，就要构造柯南的头有多大，眼睛大小之类的吧，上什么色吧，就像数字油画给你的那个有数字，不同格子填什么色的，这个格子就是可以当成渲染树的节点，那这个集合构成就是渲染树啦；</li>
<li>最后，我这个大画家就要开始作画啦，那你画到画布上的过程就是绘制painting啦，painting这个词形象生动O(∩_∩)O~</li>
</ol>
<p>不知道这样说，清楚没呢~</p>
<p>所以，一旦DOM树变化，影响了页面元素的几何属性（宽高）————比如，改变了元素border或者给段落添加文字增加了行数————这样的话，浏览器就要重新计算元素的几何属性，以及其他受影响的元素。这时浏览器起作用啦，就会让渲染树受影响部分失效，进行重新计算，再<strong>重新构造渲染树</strong>，这个过程就叫做“<strong>重排热flow</strong>”，重排完成后，浏览器会把受影响部分的元素重新显示（绘制）到屏幕上，这一过程就叫做“<strong>重绘</strong>”。就这样理解嘛，活字印刷术里，你要写文字，你的文字都还没有排好，怎么进行印刷呢。</p>
<p>但是呢，并不是有了重排才会有重绘，就比如，你页面元素的几何属性就修改背景颜色，其他都不改，这个行为是没有触发重排的（因为没有修改元素的布局），但是浏览器需要进行一次重绘，把新的背景颜色绘制到屏幕上。</p>
<h3 id="重排怎么触发（发生）？"><a href="#重排怎么触发（发生）？" class="headerlink" title="重排怎么触发（发生）？"></a>重排怎么触发（发生）？</h3><blockquote>
<p>当页面布局和几何属性改变时就需要重排。举栗子</p>
</blockquote>
<ul>
<li>添加或删除<strong>可见</strong>DOM元素，注意是可见，不可见的根本就不在渲染树上好吗；</li>
<li>元素位置改变；就如把A移动到B，B移动到A</li>
<li>元素尺寸改变（包括：padding，margin，border，width，height等属性改变时）；</li>
<li>内容改变，如文本改变，或者图片被另一个不同尺寸的图片替换</li>
<li>页面渲染器初始化</li>
<li>浏览器窗口尺寸变化，这里我就有点疑问，那要是我每次缩放浏览器不都会触发吗？？？</li>
<li>最后，页面出现滚动条时也会触发。。。</li>
</ul>
<a id="more"></a>
<h3 id="渲染树变化的排队与刷新"><a href="#渲染树变化的排队与刷新" class="headerlink" title="渲染树变化的排队与刷新"></a>渲染树变化的排队与刷新</h3><p>因为每一次的重排都会消耗很大一部分的性能，所以，浏览器一般都会通过<strong>队列化修改并批量执行</strong>来优化重排过程。但是你可能没注意使用到一些属性，就会强制刷新队列并计划任务立马执行，就马上重排了！！！</p>
<blockquote>
<p>获取布局信息的操作会强制队列刷新，所以，以下的属性尽量避免使用！</p>
</blockquote>
<ul>
<li>offsetTop，offsetLeft，offsetWidth，offsetHeigt；</li>
<li>scrollTop，scrollLeft，scrollWidth，scrollHeight;</li>
<li>clientTop，clientLeft，clientWidth，clientHeight;</li>
<li>getComputedStyle() （currentStyle in IE）</li>
</ul>
<h3 id="最小化重绘和重排"><a href="#最小化重绘和重排" class="headerlink" title="最小化重绘和重排"></a>最小化重绘和重排</h3><h4 id="改变样式"><a href="#改变样式" class="headerlink" title="改变样式"></a>改变样式</h4><p>改变样式时，最后就是，合并所有的改变，然后一次性处理，这样就只会修改DOM一次，做到最小化重排啦</p>
<h4 id="批量修改DOM"><a href="#批量修改DOM" class="headerlink" title="批量修改DOM"></a>批量修改DOM</h4><p>方法有很多</p>
<ul>
<li>为需要修改的节点创建备份，然后对副本进行修改，修改完成后就用它来对旧的节点进行替换</li>
<li>（墙裂推荐）使用创建文档片段createDocumentFragment的方法，具体可以看我之前关于文档片段的笔记，因为这种方法产生的DOM遍历和重排次数是最少的。</li>
</ul>
<p>嗯，重排和重绘就先这样吧。可以结合前面摘的浏览器工作流~</p>

				</div>
			</div>
			<div class="subinfo">
				<a href="">
					2016-09-13
				</a>
				
  <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能/">性能</a></li></ul>

			</div>
		</div>
		<!--文章列表 end-->

		<!--分页 start-->
		<div class="m-page f-cb">
	
		
			<a class="f-fl" href="/2017/02/15/http概述——http笔记一/">
				上一篇
			</a>
		
		
			<a class="f-fr" href="/2016/09/13/浏览器工作流/">
				下一篇
			</a>
		
	
</div>
		<!--分页 end-->
	</div>
</div>




			<div class="main-footer">
	<div class="m-ft container"><span title="Copyright">©</span>
		<a href="http://tvwawawa.lofter.com/">tv_哇</a> | Powered by
		<a href="https://hexo.io/">Hexo</a>
	</div>
</div>
		</div>
		<script>
	window.onload = function() {
		// 可爱title切换
		var OriginTitile = document.title;
		var st;
		document.addEventListener('visibilitychange', function() {
			if(document.hidden) {
				document.title = unescape("%28%u3064%u30A7%u2282%29%u6211%u85CF%u597D%u4E86%u54E6") + "★" + OriginTitile;
				clearTimeout(st);
			} else {
				document.title = unescape("%28*%B4%u2207%uFF40*%29%20%20%u88AB%u4F60%u53D1%u73B0%u5566%7E%20") + "★" + OriginTitile;
				st = setTimeout(function() {
					document.title = OriginTitile;
				}, 4000);
			}
		});
	}
</script>
<script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script> 
<script>hljs.initHighlightingOnLoad();</script> 

		<!--google analytics--> 
		
	</body>
</html>